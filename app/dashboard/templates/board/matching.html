{% comment %}
  Copyright (C) 2019 Gitcoin Core

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program. If not,see
  <http://www.gnu.org/licenses/>.
{% endcomment %}
{% load i18n static add_url_schema avatar_tags %}

<div class="tab-pane fade " id="nav-matching" role="tabpanel" aria-labelledby="nav-matching-tab">
  <header class="container position-relative">
    <div class="row mb-2">
      <div class="col-12">
        <div class="bg-white rounded p-3">
          <h5 class="font-weight-bold">
            Organisation tribes
          </h5>
          <p>You can join organisations tribes to keep working on their bounties. <a href="">What is a Tribe?</a></p>
          <!-- {{user.profile.tribe_members}} -->
          <div class="grid-5 mt-5">
            {% for profile, num_times in works_with_collected.items %}
              <!-- {{profile}} -->
              {% if profile in user.profile.tribe_members.list %}
              is here
              {% endif %}

              <div class="card border-0 card-shadow">
                <div class="bg-lightblue text-center">
                  <img height="80" width="80" class="rounded-circle mt-n4 mx-auto mb-2 d-block shadow-sm" src="{% avatar_url profile %}" />
                  <span class="d-block text-truncate">{{profile}}</span>
                  <a class="font-body" href="{% url 'profile' profile %}">
                    {{profile}}
                  </a>
                </div>
                <div class="p-2 card-body d-flex flex-column justify-content-end">
                  {% if user.is_authenticated and profile%}
                    <div class="d-flex justify-content-between mt-2">
                        <!-- <a href="{% url 'bounty_requests' %}" class="btn btn-outline-gc-blue btn-sm btn-block">Suggest a Bounty</a> -->
                        <button class="btn btn-sm btn-gc-blue btn-block" @click="joinTribe({{profile}}, $event)">Join Tribe</button>

                    </div>
                  {% endif %}
                </div>
              </div>

            {% endfor %}
          </div>
          <!-- {% for tribe in user.profile.tribe_members %}
          {{tribe.org}} tribe
          {% endfor %} -->
        </div>
      </div>
    </div>
  </header>
  <section class="container">
    <div class="row">
      <div class="col-12">
        <div class="bg-white rounded border my-4">
          <div class="d-flex justify-content-between p-4 border-bottom btn-gc-blue btn-sm">
            <div v-if="skills && skills[0]">
              Bounties matching your skills: <b>[[ skills.join(', ') ]]</b> <a href="{% url 'matching_settings' %}" class="white underline">(Update Skills)</a>
            </div>
            <div v-else>
              Update your skills to get the right matches <a href="{% url 'matching_settings' %}" class="white underline">Update Skills</a>
            </div>
          </div>

          <div >
            <ul class="list-unstyled list-bounty">
              <li class="position-relative font-smaller-1 mt-3 p-3 list-bounty-item" v-for="(bounty, key) in matchingBounties">
                <span class="fa-stack mr-2">
                  <i class="fas fa-circle fa-stack-2x blue"></i>
                  <i class="fas fa-user fa-stack-1x fa-inverse"></i>
                </span>
                <span class="font-weight-bold">New bounty matching your skills</span>
                <div class="d-flex flex-column flex-lg-row justify-content-between align-items-center border p-3 my-2 ml-5 rounded">
                  <div class="list-bounty-item_content my-auto">
                    <div class="d-flex">
                      <img :src="bounty.avatar_url" alt="Avatar" width="40" height="40" class="flex-shrink-0 mr-2 rounded-circle">
                      <div class="d-flex flex-column w-100 ml-md-3">
                        <div class="">
                          <a :href="bounty.url" data-toggle="tooltip" title="View profile" class="text-dark">[[ bounty.title ]]</a>
                          <span v-if="bounty.event" class="hackathon-alt">[[ bounty.event.name ]]</span>
                        </div>
                        <div class="d-flex flex-column flex-md-row justify-content-between font-smaller-2">
                            <template v-if="bounty.project_type">
                              <span class="my-1">[[ bounty.project_type ]]</span> <span class="d-md-block d-none mx-2 my-auto">&bull;</span>
                            </template>
                            <template v-if="bounty.expires_date">
                              <time :datetime="[[ bounty.expires_date ]]" class="my-1" :title="[[ bounty.expires_date ]]">Expires [[ bounty.expires_date | moment ]]</time> <span class="d-md-block d-none mx-2 my-auto">&bull;</span>
                            </template>
                            [[bounty.keywords]]
                            <span class="my-1">[[bounty.value_in_token | humanizeEth ]] [[ bounty.token_name ]] ([[ bounty.value_in_usdt ]] USD)</span>
                            <a :href="bounty.url" title="View bounty details" class="mx-md-2 my-1"><i class="fas fa-eye"></i> View Issue Details</a>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div>
                    <a :href="bounty.url" title="View bounty details" class="btn btn-sm btn-gc-blue">View Details</a>
                  </div>
                </div>
              </li>
              <li class="text-center my-5" :class="{'d-none': (isLoading.matchingBounties || matchingBounties && matchingBounties.length > 0) }">
                <h4 class="h5 font-weight-semibold my-3">
                  No matching bounties at the moment.
                </h4>
                <p class="text-black-70">Check back regularly for the latest matching bounties or <br> check out the <b>Issue Explorer</b> for more bounties!</p>
              </li>
              <li class="text-center">
                <a :href="`/explorer?network=${network}&applicants=ALL&keywords=${skills}&order_by=-web3_created`" class="btn btn-outline-gc-blue w-75 font-smaller-2 gc-letter-spacing" target="_blank">VIEW MORE BOUNTIES</a>
              </li>
            </ul>
            <loading-screen v-if="isLoading.matchingBounties"></loading-screen>
          </div>


        </div>
      </div>
    </div>
  </section>





  <section class="container">
    <div class="row text-center py-5">
      <div class="col-12">
        <p>
          If you also want to check your finished bounties, you can find them here:
        </p>
        <a class="btn btn-gc-blue" href="/explorer?bounty_filter=startedByMe&network=mainnet&order_by=-web3_created">Check my bounties in the explorer</a>
      </div>
    </div>
  </section>
</div>
