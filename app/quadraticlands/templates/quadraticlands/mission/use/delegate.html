{% extends 'quadraticlands/components/base.html' %}
{% load humanize static i18n %}

{% block 'twittercard' %}
	<!-- twitter card -->
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:site" content="@gitcoin" />
	<meta name="twitter:title" content="title" />
	<meta name="twitter:description" content="description" />
	<meta name="twitter:image" content="https://s.gitcoin.co/static/quadraticlands/twittercards/xxxxx.gif" />
	<!-- end twitter card -->
{% endblock %}


{% block 'content' %}

<!-- hide footer, header as this is a fullscreen experience -->
{% include 'quadraticlands/components/fullscreen.html' %}


<section class="background">
	<img src="/static/quadraticlands/images/background/anim-9.svg">
</section>





<section class="quest">

	<main>

		<div class="wrapper scrollable">

			<section class="introduction">
				<h1>Empower a<br>Gitcoin Senator</h1>
				<p>Delegate your voting power to an official Gitcoin Senator</p>	
			</section>

			<!-- senators -->
			<div class="quest-senators">

				{% include 'quadraticlands/mission/use/senator_item.html' with name="Cody Fisher" description="Lorem ipsum" image="senator-dummy.jpg" discourse_id="1" address="0xB8B281E556c478583087Ae5af5356B485B83E819" %}

				{% include 'quadraticlands/mission/use/senator_item.html' with name="Dr. Max Muster" description="Lorem ipsum" image="senator-dummy.jpg" discourse_id="2" address="0x3087Ae547858f485B83E8195356BaB8B281E556c" %}

				{% include 'quadraticlands/mission/use/senator_item.html' with name="Melanie Power" description="Lorem ipsum" image="senator-dummy.jpg" discourse_id="3" address="0xe5aB8B281E556c43087A7858f53583E8196B485B" %}

				{% include 'quadraticlands/mission/use/senator_item.html' with name="Cody Fisher" description="Lorem ipsum" image="senator-dummy.jpg" discourse_id="4" address="0xB8B281E556c478583087Ae5af5356B485B83E819" %}

				{% include 'quadraticlands/mission/use/senator_item.html' with name="Dr. Max Muster" description="Lorem ipsum" image="senator-dummy.jpg" discourse_id="5" address="0x3087Ae547858f485B83E8195356BaB8B281E556c" %}

				{% include 'quadraticlands/mission/use/senator_item.html' with name="Melanie Power" description="Lorem ipsum" image="senator-dummy.jpg" discourse_id="6" address="0xe5aB8B281E556c43087A7858f53583E8196B485B" %}

			</div>


			<!-- hidden address of a senator -->
			<input id="delegate_address" type="text" value="" class="hide">


			<section class="introduction">
				<h1><span class="aqua">- or -</span><br>delegate to any address</h1>
				<p>Explore other community members in our <a href="#">discourse forum</a> and delegate your voting power to there ethereum adress. If you want to claim your tokens to a cold wallet / hardware wallet, you can also delegate the voting power of this cold wallet to another hot wallet here, by paste this custom ethereum adress here.</p>	
			</section>

			<div class="quest-delegateaddress">
				<input id="custom_delegate_address" type="text" value="" placeholder="Paste an Ethereum Address">
			</div>




		</div>

	</main>













	<!-- timer / seperator -->
	<div class="seperator">
	</div>

	<!-- bottom navigation -->
	<nav class="glass">

		<div class="left">
			<a href="/quadraticlands/">Exit</a>
		</div>

		<div class="center">
			Proof of Use
		</div>

		<!-- button status -->
		<div class="right">

			<!-- intro - start voting process -->
			<div>
				<a id="btn_continue" class="btn hide">Continue</a>
			</div>

		</div>

	</nav>
	

</section>





{% endblock %}





{% block 'scripts' %}

<!--APP - burger menu, wallet menu, provider select, collapse, flashMessage-->
<script src="/static/quadraticlands/js/app.js"></script>

<!-- this page NEEDS a Wallet and will force the Web3Modal -->
<script src="/static/quadraticlands/js/forceWallet.js"></script>



<script>


document.addEventListener("DOMContentLoaded",function(){

	const senators = document.querySelectorAll(".senator-card")
	
	// senators address
	const delegate_address = document.getElementById("delegate_address")

	// custom input field 
	const custom_delegate_address = document.getElementById("custom_delegate_address")

	// buttons to pick a senator ( one button per senator )
	const btnSenatorSelect = document.querySelectorAll(".button-senator-select")
	
	btnSenatorSelect.forEach(senator => {
		senator.addEventListener("click", () => {
			
			// reset a maybe set custom_delegate_address - as the user want to pick a senator address
			custom_delegate_address.value =""

			// read adress from data atribute rendered on "delegate" button
			delegate_address.value = senator.dataset.address

			// save delegate_adress in input field
			// 

			// reset current selection (by remove classes from all cards) in interface
			senators.forEach(senator => { senator.classList.remove("selected") });

			// select a senator in interface
			delegate = senator.closest(".senator-card")
			delegate.classList.add("selected")

			// enable continue button as user selected a senator
			btn_continue.classList.remove("hide")

		});
	});



	// connect submit button with submit function
	const btn_continue = document.getElementById("btn_continue")
	btn_continue.addEventListener("click", () => {
		submit()
	});
	



	// check for inputs on the custom_delegate_address input field
	// + remove a picked senator from delegate_address
	// + unselect a picked senator from interface
	// + enable the "continue" button on a valid address

	
	custom_delegate_address.addEventListener("input", () => {

		// reset current selection of senators (by remove classes from all cards) in interface
		senators.forEach(senator => { senator.classList.remove("selected") });

		// reset the delegate_address as user have a custom address
		delegate_address.value = ""

		// disable the continue button
		btn_continue.classList.add("hide")

		// check if this adress is a valid address
	
		if (web3.utils.toChecksumAddress(custom_delegate_address.value))
		{
			btn_continue.classList.remove("hide")
		}
		else{
			console.log("no valid address")
		}

	});




});





// submit the delegate_address to a database and forward to outro page

function submit(){

	// picked address of a senator
	delegate_address = document.getElementById("delegate_address").value

	// custom address 
	custom_delegate_address = document.getElementById("custom_delegate_address").value

	if (delegate_address){
		address = delegate_address
		console.log ("SENATOR DELEGATE ADDRESS :" + delegate_address)	
	}

	if (custom_delegate_address){
		address = custom_delegate_address
		console.log ("CUSTOM DELEGATE ADDRESS :" + delegate_address)	
	}

	// this is the address to safe in DB or LOCAL STORAGE
	console.log(address)

	// then forward to this url 
	// window.location = "/quadraticlands/mission/use/outro";

}








/*********** VIEWS */

function updateInterface(status){



}



</script>




{% endblock %}




