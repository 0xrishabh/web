{% extends 'quadraticlands/components/base.html' %}
{% load humanize static i18n %}

{% block 'content' %}

<!-- hide footer, header as this is a fullscreen experience -->
{% include 'quadraticlands/components/fullscreen.html' %}


<section class="background">
	<img src="/static/quadraticlands/images/background/vote.svg">
</section>


<section class="quest">

	<!-- content-->
	<main>
		<div class="wrapper">
			<div class="claim">
				<h3>Vote</h3>
				<h1>Does Gitcoin needs a Redesign?</h1>
				<p style="margin-bottom:2em;">Connect your wallet with snapshot.page and contribute in our this vote. Then come back.</p>
				<a class="btn" target="_blank" href="https://snapshot.page/#/yam/proposal/QmQxMTQkz7fW3AXma69ueEwhq5Sf8HNdUYseEFQFw3uKEx">Vote</a>
			</div>
		</div>
	</main>

	<!-- timer / seperator -->
	<div class="seperator"></div>

	<!-- bottom navigation -->
	<nav>

		<div class="left">
			<a href="/quadraticlands/">Exit</a>
		</div>

		<div class="center">
			Proof of Use
		</div>

		<div class="right">
			<div id="nextButton" class="hide" >
				<a class="btn" href="/quadraticlands/mission/use/outro">Continue</a>
			</div>
			
			<div id="waitingSpinner">
				{% include "quadraticlands/_inlinesvg/spinner.svg" %}
			</div>
		</div>

	</nav>
	

</section>




{% endblock %}



{% block 'scripts' %}


<script>


// check specific proposal on a snapshot space
// for adress ( did a user voted on this )

document.addEventListener("DOMContentLoaded",function(){

	window.addEventListener("dataWalletReady", () => {

		// space, proposal, interval, adress
		checkShapshotProposalForAdress(
			"wolfdefi",
			"QmaLD93xmBTPqBtWCjGV9CaztUkavm8uNoanMMmzcJS7iY",
			5000,
			selectedAccount
		);

	});

});





function checkShapshotProposalForAdress(space, proposal, interval, adress){

	const url = "https://hub.snapshot.page/api/" + space + "/proposal/" + proposal;


	setInterval(() => {

		fetch(url)
			.then(response => response.json())
			.then(data => 
				{
				console.log(data);

				for (const [address] of Object.entries(data)) {

				if ( address == userAddress )
				{
					console.log("checkAPi : true (userAddress is in Proposal)");
					// hide spinner
					const waitingSpinner = document.getElementById("waitingSpinner");
					waitingSpinner.classList.add("hide");
					// show next button
					const nextButton = document.getElementById("nextButton");
					nextButton.classList.remove("hide");
				}

				}
			}
		)


	}, interval);


}











</script>



{% endblock %}


